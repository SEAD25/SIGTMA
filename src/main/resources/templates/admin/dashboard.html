<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    th:replace="~{layout/base :: html(title='Dashboard Admin | SIGTMA', activePage='dashboard', pageTitle='Tableau de Bord')}">

<head></head>

<body>
    <div th:fragment="content">
        <!-- Filtres de Période -->
        <div class="d-flex justify-content-between align-items-center mb-5">
            <div>
                <h3 class="fw-bold mb-1 text-forest">Aperçu Analytique</h3>
                <p class="text-muted small mb-0">Suivi global des activités du système</p>
            </div>
            <div class="glass-card p-1 rounded-pill d-flex gap-1" style="background: rgba(255,255,255,0.6);">
                <button onclick="updateStats('global')"
                    class="btn btn-sm btn-period active px-4 rounded-pill border-0 fw-medium"
                    id="btn-global">Global</button>
                <button onclick="updateStats('annuel')"
                    class="btn btn-sm btn-period px-4 rounded-pill border-0 fw-medium" id="btn-annuel">Année</button>
                <button onclick="updateStats('mensuel')"
                    class="btn btn-sm btn-period px-4 rounded-pill border-0 fw-medium" id="btn-mensuel">Mois</button>
                <button onclick="updateStats('journalier')"
                    class="btn btn-sm btn-period px-4 rounded-pill border-0 fw-medium" id="btn-journalier">Jour</button>
            </div>
        </div>

        <div class="row g-4 mb-5">
            <div class="col-md-6 col-xl-3">
                <div class="card border-0 bg-emerald-vibrant text-white p-4 shadow-custom overflow-hidden position-relative h-100"
                    style="border-radius: 2rem;">
                    <div class="position-relative" style="z-index: 2;">
                        <p class="small mb-0 opacity-75 fw-medium">Total Dépôts</p>
                        <h2 class="fw-bold mb-0 mt-1" id="statTotalTheses">0</h2>
                        <div class="mt-3">
                            <span class="badge bg-white bg-opacity-20 rounded-pill extra-small px-3">Enregistrés</span>
                        </div>
                    </div>
                    <i class="fas fa-file-alt position-absolute end-0 bottom-0 mb-n3 me-n3 opacity-10 fa-6x"
                        style="transform: rotate(-15deg);"></i>
                </div>
            </div>
            <div class="col-md-6 col-xl-3">
                <div class="card border-0 bg-brand-gradient text-white p-4 shadow-custom overflow-hidden position-relative h-100"
                    style="border-radius: 2rem;">
                    <div class="position-relative" style="z-index: 2;">
                        <p class="small mb-0 opacity-75 fw-medium">Validées</p>
                        <h2 class="fw-bold mb-0 mt-1" id="statValidees">0</h2>
                        <div class="mt-3">
                            <span class="badge bg-white bg-opacity-20 rounded-pill extra-small px-3">Archivées</span>
                        </div>
                    </div>
                    <i class="fas fa-check-circle position-absolute end-0 bottom-0 mb-n3 me-n3 opacity-10 fa-6x"
                        style="transform: rotate(-15deg);"></i>
                </div>
            </div>
            <div class="col-md-6 col-xl-3">
                <div class="card border-0 bg-mint-vibrant text-white p-4 shadow-custom overflow-hidden position-relative h-100"
                    style="border-radius: 2rem;">
                    <div class="position-relative" style="z-index: 2;">
                        <p class="small mb-0 opacity-75 fw-medium">En Attente</p>
                        <h2 class="fw-bold mb-0 mt-1" id="statEnAttente">0</h2>
                        <div class="mt-3">
                            <span class="badge bg-white bg-opacity-20 rounded-pill extra-small px-3">À Vérifier</span>
                        </div>
                    </div>
                    <i class="fas fa-clock position-absolute end-0 bottom-0 mb-n3 me-n3 opacity-10 fa-6x"
                        style="transform: rotate(-15deg);"></i>
                </div>
            </div>
            <div class="col-md-6 col-xl-3">
                <div class="card border-0 bg-forest-gradient text-white p-4 shadow-custom overflow-hidden position-relative h-100"
                    style="border-radius: 2rem;">
                    <div class="position-relative" style="z-index: 2;">
                        <p class="small mb-0 opacity-75 fw-medium">Staff UASZ</p>
                        <h2 class="fw-bold mb-0 mt-1" id="statTotalUsers">0</h2>
                        <div class="mt-3">
                            <span class="badge bg-white bg-opacity-20 rounded-pill extra-small px-3">Actifs</span>
                        </div>
                    </div>
                    <i class="fas fa-users-gear position-absolute end-0 bottom-0 mb-n3 me-n3 opacity-10 fa-6x"
                        style="transform: rotate(-15deg);"></i>
                </div>
            </div>
        </div>

        <div class="row g-4">
            <div class="col-lg-8">
                <div class="card p-4 h-100 shadow-sm border-0">
                    <h5 class="fw-bold mb-4">Tendances des Dépôts</h5>
                    <div style="height: 300px;">
                        <canvas id="chartActivity"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card p-4 h-100 shadow-sm border-0">
                    <h5 class="fw-bold mb-4">Activité du Réseau</h5>
                    <div class="mt-2 text-center py-4 bg-light rounded-4 mb-4">
                        <i class="fas fa-signal fa-3x text-emerald opacity-20"></i>
                    </div>
                    <h6>Trafic par Filière</h6>
                    <div class="mt-3">
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-1 small text-muted">
                                <span>Informatique</span>
                                <span>65%</span>
                            </div>
                            <div class="progress rounded-pill" style="height: 8px;">
                                <div class="progress-bar bg-emerald" style="width: 65%;"></div>
                            </div>
                        </div>
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-1 small text-muted">
                                <span>Sciences Juridiques</span>
                                <span>25%</span>
                            </div>
                            <div class="progress rounded-pill" style="height: 8px;">
                                <div class="progress-bar bg-emerald" style="width: 25%; opacity: 0.6;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script th:inline="javascript">
            let activityChart;

            document.addEventListener('DOMContentLoaded', () => {
                initChart();
                updateStats('global');
            });

            function initChart() {
                const ctx = document.getElementById('chartActivity').getContext('2d');
                activityChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Féb', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil'],
                        datasets: [{
                            label: 'Dépôts',
                            data: [12, 19, 3, 5, 2, 3, 7],
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { display: false } },
                            x: { grid: { display: false } }
                        }
                    }
                });
            }

            function updateStats(period) {
                // Update button UI
                document.querySelectorAll('.btn-period').forEach(btn => btn.classList.remove('active', 'btn-emerald', 'text-white'));
                const activeBtn = document.getElementById('btn-' + period);
                activeBtn.classList.add('active', 'btn-emerald', 'text-white');

                fetch(`/api/admin/stats/summary?period=${period}`)
                    .then(res => res.json())
                    .then(data => {
                        document.getElementById('statTotalTheses').innerText = data.totalTheses;
                        document.getElementById('statValidees').innerText = data.thesesValidees;
                        document.getElementById('statEnAttente').innerText = data.thesesEnAttente;
                        document.getElementById('statTotalUsers').innerText = data.totalUsers;
                    });
            }
        </script>

        <style>
            .btn-period:not(.active):hover {
                background-color: #f8fafc;
            }

            .bg-warning-soft {
                background-color: #fffbeb !important;
                color: #d97706 !important;
            }

            .bg-primary-soft {
                background-color: #eff6ff !important;
                color: #2563eb !important;
            }
        </style>
    </div>
</body>

</html>